<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Viewing Room H.D Galerie</title>

<style>
html, body {
  height: 100%;
  margin: 0;
  background: #fff;
}

iframe {
  width: 100%;
  height: 100%;
  border: 0;
  display: block;
}
</style>
</head>

<body>

<iframe id="vr" allowfullscreen></iframe>

<script>

// ðŸ‘‰ Viewing room par dÃ©faut (HD Galerie)
const DEFAULT_EMBED = "https://airtable.com/embed/appd2uoTfbeo9v1IU/shrGj2FnVG7XsgZ7X";

function getSlug() {

  const params = new URLSearchParams(window.location.search);

  // ancien systÃ¨me ?path=
  const pathParam = params.get("path");
  if (pathParam) {
    return decodeURIComponent(pathParam).trim().toLowerCase();
  }

  // nouveau systÃ¨me /slug
  const path = window.location.pathname
    .replace(/^\/+|\/+$/g, "")
    .trim()
    .toLowerCase();

  return path || null;
}

async function loadViewingRoom() {

  const iframe = document.getElementById("vr");
  if (!iframe) return;

  const params = new URLSearchParams(window.location.search);

  // support embed direct (ancien systÃ¨me)
  const embedParam = params.get("embed");
  if (embedParam) {
    iframe.src = decodeURIComponent(embedParam);
    return;
  }

  const slug = getSlug();

  // ðŸ‘‰ Si homepage â†’ afficher HD Galerie
  if (!slug) {
    iframe.src = DEFAULT_EMBED;
    return;
  }

  try {

    const res = await fetch(`/api/resolve?slug=${encodeURIComponent(slug)}`, {
      cache: "no-store"
    });

    if (!res.ok) throw new Error("Slug not found");

    const data = await res.json();

    iframe.src = data.embed || DEFAULT_EMBED;

  } catch (e) {

    // fallback sÃ©curitÃ©
    iframe.src = DEFAULT_EMBED;
  }
}

document.addEventListener("DOMContentLoaded", loadViewingRoom);

</script>

</body>
</html>
