<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Viewing Room H.D Galerie</title>

<style>
html, body {
  height: 100%;
  margin: 0;
  background: #fff;
}

iframe {
  width: 100%;
  height: 100%;
  border: 0;
  display: block;
}
</style>

</head>

<body>

<iframe id="vr" allowfullscreen></iframe>

<script>

// Homepage fallback
const DEFAULT_EMBED = "https://airtable.com/embed/appd2uoTfbBeo9vI1U/shrGj2FnVG7XsgZ7X";

function getSlug() {

  const params = new URLSearchParams(window.location.search);

  const pathParam = params.get("path");
  if (pathParam) {
    return decodeURIComponent(pathParam).trim().toLowerCase();
  }

  const path = window.location.pathname
    .replace(/^\/+|\/$/g, "")
    .trim()
    .toLowerCase();

  return path || null;
}

async function load() {

  const params = new URLSearchParams(window.location.search);
  const embedParam = params.get("embed");
  const iframe = document.getElementById("vr");

  if (!iframe) return;

  if (embedParam) {
    iframe.src = decodeURIComponent(embedParam);
    return;
  }

  const slug = getSlug();

  if (!slug) {
    iframe.src = DEFAULT_EMBED;
    return;
  }

  try {

    const res = await fetch(`/api/resolve?slug=${encodeURIComponent(slug)}`, {
      cache: "no-store"
    });

    if (!res.ok) throw new Error("Slug not found");

    const data = await res.json();

    iframe.src = data.embed || DEFAULT_EMBED;

  } catch {
    iframe.src = DEFAULT_EMBED;
  }

}

load();

</script>

</body>
</html>
